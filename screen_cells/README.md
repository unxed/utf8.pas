

По идее, это через wcswidth делать надо, потому что она учитывает контекст,
а мы считаем отдельные длины каждой кодовой точки.

А, стоп. Так не получится.

If a nonprintable wide character occurs among these characters, -1 is returned

Она на самом деле не учитывает контекст, а просто ломается на первом же непечатном символе.

